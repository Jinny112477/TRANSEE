<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Activity</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../src/style/Activity.css">

    <!-- Favicon -->
  <link rel="icon" type="image/png" href="../src/Picture/favicon.png" sizes="64x64">
  <link rel="shortcut icon" href="../src/Picture/favicon.png">
  <link rel="apple-touch-icon" href="../src/Picture/favicon.png">
  
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"/>
</head>

<body>

<!-- ปุ่มไอคอน Home -->
    <div style="position: absolute; top: 30px; left: 30px; z-index: 1000">
      <i id="homeIcon" class="bi bi-house-fill" style="cursor: pointer"></i>
    </div>

  <!-- Logo at top-right -->
<div
  style="
    position: absolute;
    top: 5px;
    right: 30px;
    z-index: 1000;
  "
>
  <img
    src="../src/Picture/Logo_TU_PINE.png"
    alt="TSE white Logo"
    style="
      height: 120px;
      object-fit: contain;
    "
  />
</div>

  <div class="container my-4 " style="position: relative;">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="fw-bold">ACTIVITY</h3>
      <select id="year-select" class="form-select w-auto">
        <option value="2568">1/2568</option>
        <option value="2569">2/2568</option>
      </select>
    </div>

    <!-- Month Tabs -->
<div class="month-bar">
  <div class="indicator"></div>
  <div class="month-label active" data-month="all">ALL</div> <!-- Added "ALL" tab -->
  <div class="month-label" data-month="1">JAN</div>
  <div class="month-label" data-month="2">FEB</div>
  <div class="month-label" data-month="3">MAR</div>
  <div class="month-label" data-month="4">APR</div>
  <div class="month-label" data-month="5">MAY</div>
  <div class="month-label" data-month="6">JUN</div>
  <div class="month-label" data-month="7">JUL</div>
  <div class="month-label" data-month="8">AUG</div>
  <div class="month-label" data-month="9">SEP</div>
  <div class="month-label" data-month="10">OCT</div>
  <div class="month-label" data-month="11">NOV</div>
  <div class="month-label" data-month="12">DEC</div>
</div>


    <div class="card-container" id ="activityList">
  </div>

  <!--Import navigation function along with supabase-->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.0/dist/umd/supabase.min.js"></script>
  <script src="../components/navigation.js"></script>

  <script>
    fetch('/api/activity')
  .then(response => response.json())
  .then(data => {
    const activityList = document.getElementById("activityList");
    activityList.innerHTML = ""; // Clear existing cards

    const selectedYear = Number(document.getElementById("year-select").value);

    // Sort activities by year → month → day
    data.sort((a, b) => {
      const dateA = new Date(a.start_date);
      const dateB = new Date(b.start_date);

      const yearA = dateA.getFullYear() + 543;
      const yearB = dateB.getFullYear() + 543;

      if (yearA !== yearB) return yearA - yearB;

      const monthA = dateA.getMonth() + 1;
      const monthB = dateB.getMonth() + 1;

      if (monthA !== monthB) return monthA - monthB;

      return dateA.getDate() - dateB.getDate();
    });

    data.forEach(activity => {
  const startDate = new Date(activity.start_date);
  const data_month = startDate.getMonth() + 1;
  const data_year = startDate.getFullYear() + 543; // Buddhist year
  const date_day = startDate.getDate();
  const month_name = startDate.toLocaleString('en-US', { month: 'long' }).toUpperCase();

  const actId = activity.id || activity.act_id || activity._id || activity.activity_id || '';
  const targetHref = `act_info.html?id=${encodeURIComponent(actId)}`;

  const cardActivity = document.createElement("div");
  cardActivity.className = "activity-card mt-4 p-3 d-flex align-items-center";
  cardActivity.onclick = function() {
    window.location.href = targetHref;
  };
  cardActivity.dataset.month = String(data_month);
  cardActivity.dataset.year = String(data_year);
  cardActivity.innerHTML = `
    <div class="folder-container">
      <div class="date-text">${date_day}</div>
    </div>
    <div class="ms-3">
      <div class="fw-bold fs-5">${month_name}</div>
      <div class="text-muted">${data_year}</div> <!-- Buddhist year -->
    </div>
    <div class="activity-info ms-auto">
      <h5 class="fw-bold mb-2" style="font-size: 1.1rem;">${activity.act_name}</h5>
      <p class="mb-1"><small style="font-size: 1rem;">${activity.place}</small></p>
    </div>
  `;
  activityList.appendChild(cardActivity);
});

    // Apply initial filter: ALL + selected year
    const activeLabel = document.querySelector(".month-label.active");
    filterCards(activeLabel.dataset.month, selectedYear);
  })
  .catch(error => console.error('Error fetching activity data:', error));
  </script>

  <script>
    window.addEventListener("DOMContentLoaded", () => {
  const labels = document.querySelectorAll(".month-label");
  const indicator = document.querySelector(".indicator");
  const yearSelect = document.getElementById("year-select");

  function moveIndicator(label) {
    indicator.style.width = `${label.offsetWidth}px`;
    indicator.style.left = `${label.offsetLeft}px`;
  }

 function filterCards(selectedMonth, selectedYear) {
  const cards = document.querySelectorAll(".activity-card");
  selectedYear = Number(selectedYear);

  cards.forEach(card => {
    const cardMonth = Number(card.dataset.month);
    const cardYear = Number(card.dataset.year);

    // Show all activities of the selected year if "ALL" is selected
    if (selectedMonth === "all" && cardYear === selectedYear) {
      card.style.display = 'flex';
    } 
    // Show only matching month & year
    else if (cardMonth === Number(selectedMonth) && cardYear === selectedYear) {
      card.style.display = 'flex';
    } 
    else {
      card.style.setProperty('display', 'none', 'important');
    }
  });
}

  // คลิกแท็บเดือน
  labels.forEach(label => {
    label.addEventListener("click", () => {
      document.querySelector(".month-label.active").classList.remove("active");
      label.classList.add("active");
      moveIndicator(label);

      filterCards(label.dataset.month, yearSelect.value);
    });
  });

  // เปลี่ยนปี
  yearSelect.addEventListener("change", () => {
    const activeLabel = document.querySelector(".month-label.active");
    filterCards(activeLabel.dataset.month, yearSelect.value);
  });

  // โหลดหน้าแรก
  const activeLabel = document.querySelector(".month-label.active");
  moveIndicator(activeLabel);
  filterCards(activeLabel.dataset.month, yearSelect.value);
});
  </script>
  </body>
</html>