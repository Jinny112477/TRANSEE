<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Transee</title>
    <link rel="stylesheet" href="../src/style/name_list.css" />

    <!-- Favicon -->
    <link
      rel="icon"
      type="image/png"
      href="../src/Picture/favicon.png"
      sizes="64x64"
    />
    <link rel="shortcut icon" href="../src/Picture/favicon.png" />
    <link rel="apple-touch-icon" href="../src/Picture/favicon.png" />
    
    <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;700&display=swap" rel="stylesheet">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div style="position: absolute; top: 30px; left: 30px; z-index: 1000">
      <i
        class="bi bi-arrow-left"
        onclick="window.location.href='admin_status.html'"
      ></i>
    </div>
    <!-- Logo at top-right -->
    <div style="position: absolute; top: 30px; right: 30px; z-index: 1000">
      <img
        src="../src/Picture/Logo_TU_PINE.png"
        alt="TSE white Logo"
        style="height: 120px; object-fit: contain"
      />
    </div>

    <div class="container">
      <div class="header">
        <h2 id="title"></h2>
        <div class="filter-search">
          <!-- üü£ Dropdown ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ -->
          <select id="statusFilter" >
            <option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            <option value="approved">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
            <option value="rejected">‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</option>
            <option value="pending">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</option>
          </select>

          <!-- üîç ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ -->
          <div class="search-box">
            <input
              type="text"
              id="searchInput"
              placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™..."
            />
            <i class="bi bi-search"></i>
          </div>
        </div>
      </div>

      <div class="student-list" id="studentList">
        <!-- <div class="student-card" data-status="approved">
        <i class="bi bi-person-circle profile-icon"></i>
        <div class="student-info">
          <div class="student-name">‡∏ô‡∏≤‡∏¢‡∏ß‡∏¥‡∏®‡∏ß‡∏∞ ‡∏ò‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</div>
          <div class="student-id">6810744563</div>
        </div>
        <div class="status-badge approved">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</div>
      </div> -->
      </div>
    </div>

    <script>
      const searchInput = document.getElementById("searchInput");
      const statusFilter = document.getElementById("statusFilter");
      const studentList = document.getElementById("studentList");
      const title = document.getElementById("title");

      // Fetch student data
      fetch(
        "/api/name_list/:id".replace(
          ":id",
          new URLSearchParams(window.location.search).get("id")
        )
      )
        .then((response) => response.json())
        .then((data) => {
          studentList.innerHTML = ""; // Clear old list
          console.log(data);

          data.forEach((student) => {
            const card = document.createElement("div");
            card.className = "student-card";
            card.setAttribute("data-status", student.status);

            const statusText =
              student.status === "approved"
                ? "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥"
                : student.status === "rejected"
                ? "‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥"
                : student.status === "pending"
                ? "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤"
                : "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞";

            // Only allow navigation if status is 'pending'
            if (student.status === "pending") {
              card.style.cursor = "pointer";
              card.onclick = function () {
                window.location.href = `approve.html?req_id=${student.id}`;
              };
            } else {
              // Gray out card for approved/rejected
              card.style.cursor = "not-allowed";
              card.style.opacity = "1";
            }

            card.innerHTML = `
          <i class="bi bi-person-circle profile-icon"></i>
          <div class="student-info">
            <div class="student-name">${student.student_info.full_name}</div>
            <div class="student-id">${student.student_id}</div>
          </div>
          <div class="status-badge ${student.status}">${statusText}</div>
        `;
            title.textContent = student.add_activity.act_name;

            studentList.appendChild(card);
          });
        });

      // Filter + Search function
      function filterStudents() {
        const filterText = searchInput.value.toLowerCase();
        const status = statusFilter.value;
        const cards = studentList.getElementsByClassName("student-card");

        for (let i = 0; i < cards.length; i++) {
          const name = cards[i]
            .getElementsByClassName("student-name")[0]
            .innerText.toLowerCase();
          const id = cards[i]
            .getElementsByClassName("student-id")[0]
            .innerText.toLowerCase();
          const cardStatus = cards[i].getAttribute("data-status");

          const matchText =
            name.includes(filterText) || id.includes(filterText);
          const matchStatus = status === "all" || cardStatus === status;

          if (matchText && matchStatus) {
            cards[i].style.display = "";
          } else {
            cards[i].style.display = "none";
          }
        }
      }

      // Event listeners
      searchInput.addEventListener("keyup", filterStudents);
      statusFilter.addEventListener("change", filterStudents);
    </script>
  </body>
</html>
