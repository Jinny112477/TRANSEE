<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StudentList2</title>
  <!-- Favicon -->
    <link
      rel="icon"
      type="image/png"
      href="../src/Picture/favicon.png"
      sizes="64x64"
    />
    <link rel="shortcut icon" href="../src/Picture/favicon.png" />
    <link rel="apple-touch-icon" href="../src/Picture/favicon.png" />
    
 <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;700&display=swap" rel="stylesheet">
  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="../src/style/StudentList2.css">
</head>
<body>

  <!-- üîô Back Button (top-left corner) -->
    <div style="position: absolute; top: 30px; left: 30px; z-index: 1000">
      <i id="backButtonYear" class="bi bi-arrow-left" style="cursor: pointer"></i>
    </div>

    </div>

  <!-- Logo at top-right -->
<div
  style="
    position: absolute;
    top: 30px;
    right: 30px;
    z-index: 1000;
  "
>
  <img
    src="../src/Picture/Logo_TU_PINE.png"
    alt="TSE white Logo"
    style="
      height: 120px;
      object-fit: contain;
    "
  />
</div>

  <div class="container d-flex flex-column align-items-center gap-4">

    <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î 1 : ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ -->
    <div class="card custom-card student-card mb-4">
      <div class="card-body text-center">
        <div class="title-container mb-3">
          <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h2>
        </div>

        <div class="d-flex flex-column flex-md-row align-items-center justify-content-center mt-4 gap-4">
          <img src="../src/Picture/Profile photo.png" alt="student" class="student-img me-md-4 mb-3 mb-md-0" id="student_img">
          <div class="text-start">
            <h2 class="student-name mb-3 text-center text-md-start" id="student_name">  </h2>

            <p class="info-label">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤:</p>
            <p class="info-value mb-2" id="student_id" style="font-size: 1.1rem;"></p>

            <p class="info-label">‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ‡πÄ‡∏Å‡∏¥‡∏î:</p>
            <p class="info-value mb-2" id="dob" style="font-size: 1.1rem;"></p>

            <p class="info-label">Email:</p>
            <p class="info-value mb-2" id="email" style="font-size: 1.1rem;"></p>

            <p class="info-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</p>
            <p class="info-value" id="phone" style="font-size: 1.1rem;"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î 2 : ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤ -->
    <div class="card custom-card education-card mb-4">
      <div class="card-body">
        <div class="title-container mb-3">
          <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤</h2>
        </div>

        <div class="education-box p-3 mt-3 mx-auto">
          <div class="d-flex align-items-center">
            <i class="bi bi-code-slash fs-3 me-3"></i>
            <div>
              <p class="major mb-1 fw-bold fs-5" id="faculty"></p>
              <p class="faculty mb-0" style="font-size: 1.1rem;">‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</p>
            </div>
          </div>
        </div>

        <div class="d-flex justify-content-center align-items-center mt-4 gap-5">
          <div class="text-center">
            <p class="text-muted mb-0" style="font-size: 1.1rem;">‡∏õ‡∏µ‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏®‡∏∂‡∏Å‡∏©‡∏≤</p>
            <p class="fw-bold fs-5 mb-0" id="year"></p>
          </div>
          <div class="divider"></div>
          <div class="text-center">
            <p class="text-muted mb-0" style="font-size: 1.1rem;">GPAX</p>
            <p class="fw-bold fs-5 mb-0" id="gpa"></p>
          </div>
        </div>
      </div>
    </div>

    <!-- ‡∏Å‡∏≤‡∏£‡πå‡∏î 3 : ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° -->
    <div class="card custom-card activity-card mb-5">
      <div class="card-body">
        <div class="title-container mb-3">
          <h2>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏£‡πâ‡∏≠‡∏á</h2>
        </div>
        <div class="activity-list mt-3" id="activity_list">
          <!-- <div class="activity-item d-flex justify-content-between align-items-center">
            <span class="fw-bold">‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏£‡∏±‡∏ö‡∏ô‡πâ‡∏≠‡∏á</span>
            <span>29/01/2025</span>
          </div> -->
          <!-- <div class="activity-item d-flex justify-content-between align-items-center">
            <span class="fw-bold">First Meet TU-PINE</span>
            <span>30/01/2025</span>
          </div> -->
        </div>
      </div>
    </div>

  </div>

  <!--Import navigation function along with supabase-->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.0/dist/umd/supabase.min.js"></script>
  <script src="../components/navigation.js"></script>
  
<script>
  // Helper: convert Gregorian year to Buddhist year
  function toBuddhistYear(dateString) {
    if (!dateString) return dateString;
    try {
      const d = new Date(dateString);
      if (isNaN(d)) return dateString; // invalid date, return as-is
      const day = ("0" + d.getDate()).slice(-2);
      const month = ("0" + (d.getMonth() + 1)).slice(-2);
      const buddhistYear = d.getFullYear() + 543;
      return `${day}/${month}/${buddhistYear}`;
    } catch (e) {
      return dateString;
    }
  }

  const studentId = new URLSearchParams(window.location.search).get('id');

  // Fetch student info
  fetch('/api/studentInfo/studentID/:student_id'.replace(':student_id', studentId))
    .then((response) => response.json())
    .then((data) => {
      document.getElementById('student_img').src = data.img;
      document.getElementById('student_name').textContent = data.full_name;
      document.getElementById('student_id').textContent = data.student_id;
      // Convert birth_date to Buddhist year format
     document.getElementById('dob').textContent = toBuddhistYear(data.birth_date);
      document.getElementById('email').textContent = data.email;
      document.getElementById('phone').textContent = data.phone_number;
      document.getElementById('faculty').textContent = '‡∏™‡∏≤‡∏Ç‡∏≤ ' + data.faculty;
      // Convert academic_year: if it's a year number, add 543
     const academicYear = data.academic_year;
     const buddhistAcademicYear = academicYear && !isNaN(academicYear) 
       ? (Number(academicYear) + 543)
       : academicYear;
     document.getElementById('year').textContent = buddhistAcademicYear;
      document.getElementById('gpa').textContent = data.GPAX;
    })
    .catch(error => console.error('Error fetching student data:', error));  

  // Fetch approved activities
  fetch('/api/approved_request/with_name/:std_id'.replace(':std_id', studentId))
    .then((response) => response.json())
    .then((data) => {
      const activityList = document.getElementById("activity_list");
      activityList.innerHTML = "";

      data.forEach((activity) => {
        if (!activity.add_activity) return;

        const card = document.createElement("div");
        card.className = "activity-item d-flex justify-content-between align-items-center";
        card.innerHTML = `
          <span style="font-size: 1.1rem;">${activity.add_activity.act_name}</span>
          <span style="font-size: 1rem;">${toBuddhistYear(activity.add_activity.start_date)}</span>
        `;
        activityList.appendChild(card);
      });
    })
    .catch(error => console.error('Error fetching approved activities:', error));
</script>


</body>
</html>
